<style type="text/css">
	table td{white-space: nowrap;}
</style>
	<div class="row wrapper border-bottom white-bg page-heading">
		<div class="col-lg-12">
			<h2><i class="fa fa-server"></i> 执行任务</h2>
			<ol class="breadcrumb">
				<li>
					<a data-ui-sref="monitor">首页</a>
				</li>
				<li>
					<a>项目与任务</a>
				</li>
				<li>
					<a data-ui-sref="project">项目</a>
				</li>
				<li>
					<a data-ui-sref="project_detail.task">执行用例</a>
				</li>
				<li class="active">
					<strong>执行任务</strong>
				</li>
				<li class="active">
					<strong>{{historyLocation}}</strong>
				</li>
			</ol>
		</div>
	</div>
<div class="tab-pane animated fadeIn active" data-ng-controller="MachineInfoController">
	<div class="panel-body" style="overflow:auto;">
		<table class="table table-striped table-bordered">
			<tbody>
				<tr>
					<th rowspan='2' style="vertical-align:middle;">服务器地址</th>
					<th colspan='4'>CPU使用情况</th>
					<th colspan='3'>磁盘使用情况</th>
					<th colspan='2'>网络使用情况</th>
					<th colspan='2'>内存使用情况</th>
				</tr>
				<tr>
					<td><a href="#" data-ng-click="getGraph('all','CPU_user_time')">用户进程</a></td>
					<td><a href="#" data-ng-click="getGraph('all','CPU_system_time')">系统进程</a></td>
					<td><a href="#" data-ng-click="getGraph('all','CPU_iowait_time')">I/O等待</a></td>
					<td><a href="#" data-ng-click="getGraph('all','CPU_idle_time')">空闲状态</a></td>
<!-- 					<td><a href="#" data-ng-click="getGraph('all','CPU_user_time')">CPU%</a></td> -->
					<td><a href="#" data-ng-click="getGraph('all','IO_dev_read_on_')">Disk Read KB/s</a></td>
					<td><a href="#" data-ng-click="getGraph('all','IO_dev_write_on_')">Disk Write KB/s</a></td>
					<td><a href="#" data-ng-click="getGraph('all','IO_rps_on_')">Disk Read r/s</a></td>
					<td><a href="#" data-ng-click="getGraph('all','IO_wps_on_')">Disk Write w/s</a></td>
					<td><a href="#" data-ng-click="getGraph('all','Incoming_network_traffic_on_')">en0-reads KB/s</a></td>
					<td><a href="#" data-ng-click="getGraph('all','Outgoing_network_traffic_on_')">en0-writes KB/s</a></td>
					<td><a href="#" data-ng-click="getMemoryGraph('all','Total_swap_space')">swaptotal MB</a></td>
					<td><a href="#" data-ng-click="getMemoryGraph('all','Available_memory')">Memfree MB</a></td>
				</tr>
				<tr data-ng-repeat="item in items">
					<td>{{item.hostIP}}</td>
					<td><a href="#" data-ng-click="getGraph(item.hostId,'CPU_user_time')">{{item.CPU_user_time}}</a></td>
					<td><a href="#" data-ng-click="getGraph(item.hostId,'CPU_system_time')">{{item.CPU_system_time}}</a></td>
					<td><a href="#" data-ng-click="getGraph(item.hostId,'CPU_iowait_time')">{{item.CPU_iowait_time}}</a></td>
					<td><a href="#" data-ng-click="getGraph(item.hostId,'CPU_idle_time')">{{item.CPU_idle_time}}</a></td>
					<td><a href="#" data-ng-click="getGraph(item.hostId,'IO_dev_read_on_' + item.diskParam)">{{item['IO_dev_read_on_' + item.diskParam]}}</a></td>
					<td><a href="#" data-ng-click="getGraph(item.hostId,'IO_dev_write_on_' + item.diskParam)">{{item['IO_dev_write_on_' + item.diskParam]}}</a></td>
					
					<td><a href="#" data-ng-click="getGraph(item.hostId,'IO_rps_on_' + item.diskParam)">{{item['IO_rps_on_' + item.diskParam]}}</a></td>
					<td><a href="#" data-ng-click="getGraph(item.hostId,'IO_wps_on_' + item.diskParam)">{{item['IO_wps_on_' + item.diskParam]}}</a></td>
					
					<td><a href="#" data-ng-click="getNetGraph(item.hostId,'Incoming_network_traffic_on_' + item.netParam)">{{item['Incoming_network_traffic_on_' + item.netParam]}}</a></td>
					<td><a href="#" data-ng-click="getNetGraph(item.hostId,'Outgoing_network_traffic_on_' + item.netParam)">{{item['Outgoing_network_traffic_on_' + item.netParam]}}</a></td>
					<td><a href="#" data-ng-click="getMemoryGraph(item.hostId,'Total_swap_space')">{{item.Total_swap_space}}</a></td>
					<td><a href="#" data-ng-click="getMemoryGraph(item.hostId,'Available_memory')">{{item.Available_memory}}</a></td>
				</tr>
			</tbody>
		</table>
	</div>
	
<!-- 	图表显示 -->
	<div class="tab-pane animated fadeIn active">
		<div class="panel-body">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><span class="glyphicon glyphicon-stats"></span> 趋势图</h3>
				</div>
				<div class="input-prepend input-group">
					<span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span>
					<input type="text" style="width: 300px;" id="dateRange" class="form-control" readonly="readonly"/>
				</div>
				<div class="panel-body" data-ng-controller="MachineInfoController">
					<div id="workChart" style="height:400px;"></div>
				</div>
			</div>
		</div>
	</div>
	
	
</div>

<script type="text/javascript" src="js/main/taskGraph.js"></script>
<script type="text/javascript">
function MachineInfoController($scope, $http, $stateParams) {
	console.log($stateParams.task_id);
	$http({
			method: 'GET',
			url: 'r/taskData/detailMonitor',
			params: {'task_id':$stateParams.task_id}
	}).success(function(data) {
			console.log("This data is ");
			console.log(data);
			$scope.items = data;
    });
	
	
	$scope.getGraph = function(hostId,type){
		console.log($stateParams.task_id);
		//显示图表数据
		var params = {
				taskId: $stateParams.task_id,
				graphDiv: 'workChart',
				title: type,
				key: type,
				hostId: hostId,
				graphType: 'line',
				formatter: 'kbps',
				scaler: 1024,
				dateRangeId: 'dateRange'
		};
		
		DataGraph(params);
	}
	
	$scope.getCPUGraph = function(hostId,type){
		console.log($stateParams.task_id);
		//显示图表数据
		var params = {
				taskId: $stateParams.task_id,
				graphDiv: 'workChart',
				title: type,
				key: type,
				hostId: hostId,
				graphType: 'line',
				formatter: '%',
				scaler: 1024,
				dateRangeId: 'dateRange'
		};
		
		DataGraph(params);
	}
	
	$scope.getMemoryGraph = function(hostId,type){
		console.log($stateParams.task_id);
		//显示图表数据
		var params = {
				taskId: $stateParams.task_id,
				graphDiv: 'workChart',
				title: type,
				key: type,
				hostId: hostId,
				graphType: 'area',
				formatter: 'G',
				scaler: 1024*1024*1024,
				dateRangeId: 'dateRangeMemory'
		};
		
		DataGraph(params);
	}
	
	$scope.getNetGraph = function(hostId,type){
		console.log($stateParams.task_id);
		//显示图表数据
		var params = {
				taskId: $stateParams.task_id,
				graphDiv: 'workChart',
				title: type,
				key: type,
				hostId: hostId,
				graphType: 'line',
				formatter: 'kbps',
				scaler: 1024,
				dateRangeId: 'dateRangeMemory'
		};
		
		DataGraph(params);
	}
	
}

</script>